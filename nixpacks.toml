# ============================================
# Nixpacks Configuration for Orbital Command Center
# Monorepo deployment (apps/web) to Railway
# ============================================

[phases.setup]
# Use Node.js 22 for Next.js 16 compatibility (requires >=20.9.0)
nixPkgs = ["nodejs_22"]

[phases.install]
# Enable Corepack for pnpm version management, then install in apps/web
cmds = [
  "corepack enable",
  "cd apps/web && pnpm install --frozen-lockfile"
]

[phases.build]
# Build the Next.js application
cmds = ["cd apps/web && pnpm build"]

[start]
# Start the production server
cmd = "cd apps/web && pnpm start"

[variables]
NODE_ENV = "production"
CI = "true"
NEXT_TELEMETRY_DISABLED = "1"
